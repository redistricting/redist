<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Merge-Split/Recombination MCMC Redistricting Sampler — redist_mergesplit • redist</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Merge-Split/Recombination MCMC Redistricting Sampler — redist_mergesplit" />
<meta property="og:description" content="redist_mergesplit uses a Markov Chain Monte Carlo algorithm to
generate congressional or legislative redistricting plans according to
contiguity, population, compactness, and administrative boundary constraints.
The MCMC proposal is the same as is used in the SMC sampler; it is similar
but not identical to those used in the references.  1-level hierarchical
Merge-split is supported through the counties parameter; unlike in
the SMC algorithm, this does not guarantee a maximum number of county splits." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/redist.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/glossary.html">Glossary of Key Redistricting Terms</a>
    </li>
    <li>
      <a href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a>
    </li>
    <li>
      <a href="../articles/mcmc.html">Redistricting with Flip MCMC</a>
    </li>
    <li>
      <a href="../articles/mpi-slurm.html">MPI / Slurm Sample Scripts</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Releases</li>
    <li>
      <a href="https://alarm-redist.github.io/posts/2021-04-02-redist-300/">redist 3.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/alarm-redist/redist/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Merge-Split/Recombination MCMC Redistricting Sampler</h1>
    <small class="dont-index">Source: <a href='https://github.com/alarm-redist/redist/blob/master/R/redist_ms_tidy.R'><code>R/redist_ms_tidy.R</code></a>, <a href='https://github.com/alarm-redist/redist/blob/master/R/redist_ms.R'><code>R/redist_ms.R</code></a></small>
    <div class="hidden name"><code>redist_mergesplit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>redist_mergesplit</code> uses a Markov Chain Monte Carlo algorithm to
generate congressional or legislative redistricting plans according to
contiguity, population, compactness, and administrative boundary constraints.
The MCMC proposal is the same as is used in the SMC sampler; it is similar
but not identical to those used in the references.  1-level hierarchical
Merge-split is supported through the <code>counties</code> parameter; unlike in
the SMC algorithm, this does not guarantee a maximum number of county splits.</p>
    </div>

    <pre class="usage"><span class='fu'>redist_mergesplit</span><span class='op'>(</span>
  <span class='va'>map</span>,
  <span class='va'>nsims</span>,
  warmup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span><span class='op'>(</span><span class='va'>nsims</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,
  init_plan <span class='op'>=</span> <span class='cn'>NULL</span>,
  counties <span class='op'>=</span> <span class='cn'>NULL</span>,
  compactness <span class='op'>=</span> <span class='fl'>1</span>,
  constraints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  constraint_fn <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span><span class='op'>)</span>,
  adapt_k_thresh <span class='op'>=</span> <span class='fl'>0.975</span>,
  k <span class='op'>=</span> <span class='cn'>NULL</span>,
  init_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  silent <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>redist.mergesplit</span><span class='op'>(</span>
  <span class='va'>adj</span>,
  <span class='va'>total_pop</span>,
  <span class='va'>nsims</span>,
  <span class='va'>ndists</span>,
  pop_tol <span class='op'>=</span> <span class='fl'>0.01</span>,
  <span class='va'>init_plan</span>,
  <span class='va'>counties</span>,
  compactness <span class='op'>=</span> <span class='fl'>1</span>,
  constraints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  constraint_fn <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span><span class='op'>)</span>,
  adapt_k_thresh <span class='op'>=</span> <span class='fl'>0.975</span>,
  k <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  silent <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>map</th>
      <td><p>A <code><a href='redist_map.html'>redist_map</a></code> object.</p></td>
    </tr>
    <tr>
      <th>nsims</th>
      <td><p>The number of samples to draw, including warmup.</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>The number of warmup samples to discard.</p></td>
    </tr>
    <tr>
      <th>init_plan</th>
      <td><p>The initial state of the map. If not provided, will default to
the reference map of the <code>map</code> object, or if none exists, will sample
a random initial state using <code><a href='redist_smc.html'>redist_smc</a></code>. You can also request
a random initial state by setting <code>init_plan="sample"</code>.</p></td>
    </tr>
    <tr>
      <th>counties</th>
      <td><p>A vector containing county (or other administrative or
geographic unit) labels for each unit, which may be integers ranging from 1
to the number of counties, or a factor or character vector.  If provided, the
algorithm will generate maps tend to follow county lines.  You may combine this
with a Gibbs constraint on the number of county splits using the
<code>constraints</code> parameter; see below. If no county-split considerations
are desired, this parameter should be left blank.</p></td>
    </tr>
    <tr>
      <th>compactness</th>
      <td><p>Controls the compactness of the generated districts, with
higher values preferring more compact districts. Must be nonnegative. See the
'Details' section for more information, and computational considerations.</p></td>
    </tr>
    <tr>
      <th>constraints</th>
      <td><p>A list containing information on constraints to implement.
See the 'Details' section for more information.</p></td>
    </tr>
    <tr>
      <th>constraint_fn</th>
      <td><p>A function which takes in a matrix where each column is
a redistricting plan and outputs a vector of log-weights, which will be
added the the final weights.</p></td>
    </tr>
    <tr>
      <th>adapt_k_thresh</th>
      <td><p>The threshold value used in the heuristic to select a
value <code>k_i</code> for each splitting iteration. Set to 0.9999 or 1 if
the algorithm does not appear to be sampling from the target distribution.
Must be between 0 and 1.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The number of edges to consider cutting after drawing a spanning
tree. Should be selected automatically in nearly all cases.</p></td>
    </tr>
    <tr>
      <th>init_name</th>
      <td><p>a name for the initial plan, or <code>FALSE</code> to not include
the initial plan in the output.  Defaults to the column name of the
existing plan, or "<code>&lt;init&gt;</code>" if the initial plan is sampled.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Whether to print out intermediate information while sampling.
Recommended.</p></td>
    </tr>
    <tr>
      <th>silent</th>
      <td><p>Whether to suppress all diagnostic information.</p></td>
    </tr>
    <tr>
      <th>adj</th>
      <td><p>adjacency matrix, list, or object of class
"SpatialPolygonsDataFrame."</p></td>
    </tr>
    <tr>
      <th>total_pop</th>
      <td><p>A vector containing the populations of each geographic
unit</p></td>
    </tr>
    <tr>
      <th>ndists</th>
      <td><p>The number of congressional districts.</p></td>
    </tr>
    <tr>
      <th>pop_tol</th>
      <td><p>The desired population constraint.  All sampled districts
will have a deviation from the target district size no more than this value
in percentage terms, i.e., <code>pop_tol=0.01</code> will ensure districts have
populations within 1% of the target population.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>redist_mergesplit</code> returns an object of class
<code><a href='redist_plans.html'>redist_plans</a></code> containing the simulated plans.</p>
<p><code>redist.mergesplit</code> returns an object of class list containing the
simulated plans.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function draws samples from a specific target measure, controlled by the
<code>compactness</code>, <code>constraints</code>, and <code>constraint_fn</code> parameters.</p>
<p>Higher values of <code>compactness</code> sample more compact districts;
setting this parameter to 1 is computationally efficient and generates nicely
compact districts.</p>
<p>The <code>constraints</code> parameter allows the user to apply several common
redistricting constraints without implementing them by hand. This parameter
is a list, which may contain any of the following named entries:</p><ul>
<li><p><code>status_quo</code>: a list with two entries:</p><ul>
<li><p><code>strength</code>, a number controlling the tendency of the generated districts
to respect the status quo, with higher values preferring more similar
districts.</p></li>
<li><p><code>current</code>, a vector containing district assignments for
the current map.</p></li>
</ul></li>
<li><p><code>vra</code>: a list with three entries:</p><ul>
<li><p><code>strength</code>, a number controlling the strength of the Voting Rights Act
(VRA) constraint, with higher values prioritizing majority-minority districts
over other considerations.</p></li>
<li><p><code>tgts_min</code>, the target percentage(s) of minority voters in minority
opportunity districts. Defaults to <code><a href='https://rdrr.io/r/base/c.html'>c(0.55)</a></code>.</p></li>
<li><p><code>min_pop</code>, A vector containing the minority population of each
geographic unit.</p></li>
</ul></li>
<li><p><code>incumbency</code>: a list with two entries:</p><ul>
<li><p><code>strength</code>, a number controlling the tendency of the generated districts
to avoid pairing up incumbents.</p></li>
<li><p><code>incumbents</code>, a vector of precinct indices, one for each incumbent's
home address.</p></li>
</ul></li>
<li><p><code>splits</code>: a list with one entry:</p><ul>
<li><p><code>strength</code>, a number controlling the tendency of the generated districts
to avoid splitting counties.</p></li>
</ul></li>
<li><p><code>vra_old</code>: a list with five entries, which may be set up using
<code><a href='redist.constraint.helper.html'>redist.constraint.helper</a></code>:</p><ul>
<li><p><code>strength</code>, a number controlling the strength of the Voting Rights Act
(VRA) constraint, with higher values prioritizing majority-minority districts
over other considerations.</p></li>
<li><p><code>tgt_vra_min</code>, the target percentage of minority voters in minority
opportunity districts. Defaults to 0.55.</p></li>
<li><p><code>tgt_vra_other</code> The target percentage of minority voters in other
districts. Defaults to 0.25, but should be set to reflect the total minority
population in the state.</p></li>
<li><p><code>pow_vra</code>, which controls the allowed deviation from the target
minority percentage; higher values are more tolerant. Defaults to 1.5</p></li>
<li><p><code>min_pop</code>, A vector containing the minority population of each
geographic unit.</p></li>
</ul></li>
</ul>

<p>All constraints are fed into a Gibbs measure, with coefficients on each
constraint set by the corresponding <code>strength</code> parameters.
The <code>status_quo</code> constraint adds a term measuring the variation of
information distance between the plan and the reference, rescaled to [0, 1].
The <code>vra</code> constraint takes a list of target minority percentages. It
matches each district to its nearest target percentage, and then applies a
penalty of the form \(\sqrt{max(0, tgt - minpct)}\), summing across
districts. This penalizes districts which are below their target population.
The <code>incumbency</code> constraint adds a term counting the number of districts
containing paired-up incumbents. The <code>splits</code> constraint adds a term
counting the number of counties which contain precincts belonging to more
than one district.
The <code>vra_old</code> constraint adds a term of the form
\((|tgtvramin-minpct||tgtvraother-minpct|)^{powvra})\), which
encourages districts to have minority percentages near either <code>tgt_vra_min</code>
or <code>tgt_vra_other</code>. This can be visualized with
<code><a href='redist.plot.penalty.html'>redist.plot.penalty</a></code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Carter, D., Herschlag, G., Hunter, Z., and Mattingly, J. (2019). A
merge-split proposal for reversible Monte Carlo Markov chain sampling of
redistricting plans. arXiv preprint arXiv:1911.01503.</p>
<p>DeFord, D., Duchin, M., and Solomon, J. (2019). Recombination: A family of
Markov chains for redistricting. arXiv preprint arXiv:1911.05725.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>fl25</span><span class='op'>)</span>

<span class='va'>fl_map</span> <span class='op'>=</span> <span class='fu'><a href='redist_map.html'>redist_map</a></span><span class='op'>(</span><span class='va'>fl25</span>, ndists<span class='op'>=</span><span class='fl'>3</span>, pop_tol<span class='op'>=</span><span class='fl'>0.1</span><span class='op'>)</span>

<span class='va'>sampled_basic</span> <span class='op'>=</span> <span class='fu'>redist_mergesplit</span><span class='op'>(</span><span class='va'>fl_map</span>, <span class='fl'>10000</span><span class='op'>)</span>

<span class='va'>sampled_constr</span> <span class='op'>=</span> <span class='fu'>redist_mergesplit</span><span class='op'>(</span><span class='va'>fl_map</span>, <span class='fl'>10000</span>, constraints<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
                     incumbency <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>strength<span class='op'>=</span><span class='fl'>1000</span>, incumbents<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>6</span>, <span class='fl'>25</span><span class='op'>)</span><span class='op'>)</span>
                 <span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>fl25</span><span class='op'>)</span>
<span class='va'>adj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='redist.adjacency.html'>redist.adjacency</a></span><span class='op'>(</span><span class='va'>fl25</span><span class='op'>)</span>
<span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>redist.mergesplit</span><span class='op'>(</span>adj <span class='op'>=</span> <span class='va'>adj</span>, total_pop <span class='op'>=</span> <span class='va'>fl25</span><span class='op'>$</span><span class='va'>pop</span>,
                         nsims <span class='op'>=</span> <span class='fl'>5</span>, ndists <span class='op'>=</span> <span class='fl'>3</span>, pop_tol <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


